# 习题1 
## 设有三个关系
S(SNO, SNAME, AGE, SEX,Sdept)

SC(SNO, CNO, GRADE)

C(CNO, CNAME, TEACHER)
<br>
<br>

### 1. 查询学号为S3学生所学课程的课程名与任课教师名。  

SELECT c.`name`, c.teacher FROM student_class sc LEFT JOIN `class` c ON sc.cno = c.NO WHERE sc.sno = 's3';
<br>
<br>

### 2. 查询至少选修LIU老师所教课程中一门课的女生姓名。  

select s.sname from student as s where s.sno in 
(select DISTINCT sc.sno from student_class as sc left join class as c on sc.cno=c.cno where c.teacher='LIU')
and s.sex=2;
<br>
<br>

### 3. 查询WANG同学不学的课程的课程号。  

select cno from sc where cno <> any
(select distinct cno from s left join(inner join) sc on s.sno = c.cno where s.sname = 'WANG')

select c.cno from class as c where c.cno not in 
(select DISTINCT sc.cno from student as s inner join student_class as sc on s.sno=sc.sno where s.sname='WANG');
<br>
<br>

### 4. 查询至少选修两门课程的学生学号。

select sno, count(*) as cou 
from sc 
group by sno 
having cou >= 2;
<br>
<br>

### 5. 查询选修课程中包含LIU老师所教全部课程的学生学号。

select sc.sno from student_class as sc INNER JOIN class as c on sc.cno=c.cno where c.teacher='LIU';
<br>
<br>

# 习题2
## 三个关系同上
S(SNO, SNAME, AGE, SEX,Sdept)

SC(SNO, CNO, GRADE)

C(CNO, CNAME, TEACHER)
<br>
<br>

### 1. 查询门门课程都及格的学生的学号

select sno from sc group by sno having min(grade)>=60;
<br>
<br>

### 2. **查询既有课程大于90分又有课程不及格的学生的学号**

select sno from sc where grade >90 and sno in (select sno from sc where grade<60)
<br>
<br>

### 3. 查询平均分不及格的课程号和平均成绩  

select cno,avg(grade) from sc group by cno having avg(grade)<60;
<br>
<br>

### 4.  **找出至少选修了2号学生选修过的全部课程的学生**

### 相当于两个for循环


    SELECT DISTINCT Sno

      FROM SC as SCX

     WHERE NOT EXISTS

      (SELECT *

       FROM SC as SCY

       WHERE SCY.Sno =‘2’AND NOT EXISTS

                               (SELECT *

                                  FROM SC SCZ

                          WHERE SCZ.Sno=SCX.Sno AND SCZ.Cno=SCY.Cno))

 1）相当于两个for循环，外层循环就是遍历所有学生学号，里层循环就是对每一位学生学号遍历所有课程。  
 2）最里面的那一个select语句便是选出该学生选过的课程，那么not exists语句便是从课程表course中选出该学生没选过的课。  
 3）外层where exists用于从sc表里选出有没选过课的学生，那么not exists便是选出选过所有课程的学生
<br>
<br>

STEP1：先取 Student 表中的第一个元组，得到其 Sno 列的值。  
STEP2：再取 Course 表中的第一个元组，得到其 Cno 列的值。  
STEP3：根据 Sno 与 Cno 的值，遍历 SC 表中的所有记录（也就是选课记录）。若对于某个 Sno 和 Cno 的值来说，在 SC 表中找不到相应的记录，则说明该 Sno 对应的学生没有选修该 Cno 对应的课程。  
STEP4：对于某个学生来说，若在遍历 Course 表中所有记录（也就是所有课程）后，仍找不到任何一门他/她没有选修的课程，就说明此学生选修了全部的课程。  
STEP5：将此学生放入结果元组集合中。  
STEP6：回到 STEP1，取 Student 中的下一个元组。  
STEP7：将所有结果元组集合显示。  
其中第一个 NOT EXISTS 对应 STEP4，第二个 NOT EXISTS 对应 STEP3。  
双not exists https://zhuanlan.zhihu.com/p/20005249
<br>
<br>

### 5.  求各门课程去掉一个最高分和最低分后的平均分

select cno,avg(grade) from sc   
where grade not in (select grade from sc order by grade limit 1 )   
  and grade not in (select grade from sc order by grade desc limit 1)  
group by cno  
<br>
<br>

### 6. 查询选修7号课程的学生的学号、姓名、性别。

select sc.sno,s.name,s.sex 
from s,sc
where  s.sno = sc.sno
and sc.cno = 7;
<br>
<br>

### 7. 查询选修7号课程的学生的平均年龄。

Select avg(sage) from s,sc where s.sno=sc.sno and cno='7';
<br>
<br>

### 8. 查询有30名以上学生选修的课程号。

select cno from sc group by cno having count(*) > 30
<br>
<br>

### 9. **查询至今没有考试不及格的学生学号**

- 方法一

Select sno from sc group by sno havingmin(grade)>=60;

- 方法二

      Select distinct sno from sc where sno not in

         ( Select sno from sc where grade<60 )
    - 先找出有不及格的人，再反选（distinct）
<br>
<br>

# 习题3
### 1. 找出选修课程号为C2或C4的学生学号

select distinct sno from sc where cno in ('c2','c4);
<br>
<br>

### **2.找出选修课程号为C2和C4的学生学号**

    Select sno from sc where cno='C2' and sno in

         ( Select sno from sc where cno='C4' )
<br>
<br>

### 3.找出数据库课程不及格的女生姓名

select s.sname from s  
where ssex = '女' sno in(  
select sc.sno from sc,c where sc.cno = c.cno and c.cname = 'shujuku' and grade < 60)

    连接：Select sname from s,sc,c
         where  s.sno=sc.sno andc.cno=sc.cno and cname='数据库'

                and grade<60 and ssex='女'

    嵌套：Select sname from s where ssex='女' and  sno in

               (Select sno from sc where grade<60 and cno in

                     ( Select cno from c where cname='数据库' )

               )
<br>
<br>

### 4.**找出选修了不少于3门课程的学生姓名**

    Select sname from s where sno in

         ( Selectsno from sc group by sno having count(*)>=3 )
<br>
<br>

### 5.找出各门课程的成绩均不低于90分的学生姓名

- 方法一  

      Select sname from s where sno not in

         ( Select sno from sc where grade<90 )

- 方法二

      Select sname from s,sc where s.sno=sc.sno

         group by s.sno,sname having min(grade)>=90
<br>
<br>

### 6.找出数据库课程成绩不低于该门课程平均分的学生姓名

select sname from s,sc   
where s.sno = sc.sno and grade > (  
select avg(grade) from sc where cno = (select cno from c where cname = 'shujuku'))

    Select snamefrom s,sc,c

    where  s.sno=sc.sno and sc.cno=c.cno and cname='数据库' and grade>

         ( Select avg(grade) from sc,c

           where sc.cno=c.cno and cname='数据库'

         )
<br>
<br>

### 7.**找出计算机系(JSJ)课程平均分最高的学生学号和姓名**

    Selects.sno,sname from s,sc where s.sno=sc.sno and sdept='JSJ'

    group bys.sno,sname

    havingavg(grade) >=ALL

         ( Select avg(grade) from s,sc

           wheres.sno=sc.sno and sdept='JSJ'

           group bys.sno

         )

<br>
<br>

### 8.***查询每门课程的及格率***

- 第1步：得到每门课的选修人数

        create view  v_all(cno,cnt)

         as selectcno, count(*) from sc group by cno

- 第2步：得到每门课及格人数

       create view  v_pass(cno,cnt_pass)

         as selectcno, count(*) from sc where grade>=60 group by cno

- 第3步：每门课的及格人数/每门课选修人数

       select v_all.cno, cnt_pass*100/cnt  from  v_all, v_pass

        where v_all.cno = v_pass.cno
<br>
<br>

### 9.查询平均分不及格的学生的学号，姓名，平均分。

select sc.sno,s.sname,avg(grade)  
from s,sc  
where sc.sno = s.sno  
group by sc.sno  
having avg(grade) < 60
<br>
<br>

### 10.查询平均分不及格的学生人数。
selet count(*) from sc where sno in  
(select sno from sc group by sno having avg(grade) < 60);
<br>
<br>


# 习题4
### 1. 查询JSJ、SX、WL系的学生学号，姓名，结果按系及学号排列

select sno,snme,sdept from s  
where sdept in ('JSJ''SX''WL')  
order by sdept,sno
<br>
<br>

### 2.查询平均分大于90分的男学生学号及平均分。

select s.sno,avg(grade)  
from s,sc  
where s.sno = sc.sno 
  and s.sex = 'male'  
group by s.sno  
having avg(grade) > 90  
<br>
<br>

### 3.查询选修课程超过2门的学生姓名

select sname from s where sno in  
(select sno from sc  
group by sno   
having count(*) > 2 )

    select sname from student,sc

    where student.sno=sc.sno

    group bysc.sno,sname

    havingcount(*)>2
<br>
<br>

### 4. 查询选修1002课程的学生的学生姓名(用连接和嵌套2种方法)

嵌套
select sname from s where sno in (select sno from sc where cno = 1002)

连接
select sname from s,sc
where s.sno = sc.sno
  and cno = 1002 ;
<br>
<br>

### 5.查询选修“数据库原理”课且成绩 80 以上的学生姓名

- 连接  
select sname from s,sc,c  
where s.sno = sc.sno   
and sc.cno = c.cno  
and c.cname = 'shujuku'   
and sc.grade > 80
<br>

- 嵌套  
select sname from s  
where sno in (select sno from sc   
where grade > 80  and cno in   
(select cno from c where cname = 'shujuku'))
<br>
<br>

###  6.查询没有选修1002课程的学生的学生姓名
select sname from s where sno not in 
(select sno from sc 
where cno = 1002)

    Select snamefrom student

    where sno notin ( select sno from sc where cno='1002')

    或： select sname from student

         where notexists

              (select * from sc where cno='1002' and sno=student.sno)
<br>
<br>

### **7.查询每门课程成绩都高于该门课程平均分的学生学号**

    SELECT DISTINCT Sno

    FROM SC SC1

    WHERE NOT EXISTS

          (SELECT *

            FROM SC SC2

            WHERE SC2.Sno=SC1.Sno AND SC2.Grade <=

                       (SELECT AVG(SC3.Grade)

                         FROM SC SC3

                         WHERE SC3.Cno=SC2.Cno

                       )

          )

<br>
<br>

### 8.检索至少选修LIU老师所授课程中一门课程的女学生姓名。
select sname from s  
where sex = 'female' and sno in     
(select sno from sc where cno in    
(select cno from c where teacher = 'LIU'))


S(SNO, SNAME, AGE, SEX,Sdept)
SC(SNO, CNO, GRADE)
C(CNO, CNAME, TEACHER)
<br>
<br>

# 习题5 &emsp;"仓库管理”关系模型有五个关系模式
零件　PART（P＃，PNAME，COLOR，WEIGHT）

项目　PROJECT（J＃，JNAME，DATE）

供应商　SUPPLIER（S＃，SNAME，SADDR）

供应　P＿P（J＃，P＃，TOTOAL）

采购　P＿S（P＃，S＃，QUANTITY）

### 1. 试用SQLDDL语句定义上述五个基本表，并说明主键和外键。
   
 &emsp;&emsp;&emsp; CREATE TABLE PART   
　　 　(P# CHAR(4) NOT NULL,PNAME CHAR(12) NOT NULL,  
　　 　COLOR CHAR(10),WEIGHT REAL,  
　　 　PRIMARY KEY(P#))  
　　 　CREATE TABLE PROJECT  
　　 　(J# CHAR(4) NOT NULL,JNAME CHAR(12) NOT NULL,  
　　 　DATE DATE,  
　　 　PRIMARY KEY(J#))  
　　 　CREATE TABLE SUPLIER  
　　 　(S# CHAR(4) NOT NULL,SNAME CHAR(12),SADDR VARCHAR(20),  
　　 　PRIMARY KEY(S#))  
　　 　CREATE TABLE P_P  
　　 　(J# CHAR(4),P# CHAR(4),TOTAL INTEGER,  
　　 　PRIMARY KEY(J#,P#),  
　　 　FOREIGN KEY(J#) REFERENCE PROJECT(J#),  
　　 　FOREIGN KEY(P#) REFERENCE PART(P#))  
　　 　CREATE TABLE P_S  
　　 　(P# CHAR(4),S# CHAR(4),QUANTITY INTEGER,  
　　 　PRIMARY KEY(P#,S#),  
　　 　FOREIGN KEY(P#) REFERENCE PART(P#),  
　　 　FOREIGN KEY(S#) REFERENCE SUPLIER(S#))
<br>
<br>

### 2.试将 PROGECT、P＿P、PART三个基本表的自然联接定义为一个视图VIEW1
### &emsp;&emsp;&emsp;PART、P＿S、SUPPLIER 三个基本表的自然联接定义为一个视图VIEW2

- view1  
CREATE VIEW VIEW1(J#,JNAME,DATE,P#,PNAME,COLOR,WEIGHT,TOTAL)  
AS SELECT PROJECT.J#,JNAME,DATE,PART.P#,PNAME,COLOR,WEIGHT,TOTAL  
FROM PROJECT,PART,P_P  
WHERE PART.P#=P_P.P# AND P_P.J#=PROJECT.J#  
    　
- view2  
CREATE VIEW VIEW2(P#,PNAME,COLOR,WEIGHT,S#,SNAME,SADDR,QUANTITY)  
AS SELECT PART.P#,PNAME,COLOR,WEIGHT,SUPPLIER.S#,SNAME,  SADDR,QUANTITY
FROM PART,P_S,SUPPLIER  
WHERE PART.P#=P_S.P# AND P_S.S#=SUPPLIER.S#